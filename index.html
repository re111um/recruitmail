<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Featuring Recruit 메일 서식</title>
  <link rel="icon" href="./favicon.ico?v=2" sizes="any">
  <link rel="icon" type="image/png" href="./favicon-32.png?v=2" sizes="32x32">
  <link rel="apple-touch-icon" href="./apple-touch-icon.png?v=2">

  <style>
    :root{
      --bg:#fafafa;
      --card:#ffffff;
      --ink:#111111;
      --muted:#6b7280;
      --line:#e5e7eb;
      --accent:#5E51FF;
      --accent-ink:#ffffff;
      --radius:16px;
      --control-h:44px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; padding:24px; background:var(--bg); color:var(--ink);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,Helvetica,"Apple SD Gothic Neo","Noto Sans KR","Malgun Gothic",sans-serif;
      line-height:1.5;
    }
    .container{
      max-width:1100px; margin:0 auto; background:var(--card);
      border:1px solid var(--line); border-radius:24px; padding:28px 28px 32px;
      box-shadow:0 10px 30px rgba(0,0,0,.03);
    }
    h1{margin:0 0 6px; font-size:32px; letter-spacing:-.02em}

    /* 1행: 기본 3열 */
    .grid{display:grid; grid-template-columns:repeat(3, minmax(0,1fr)); gap:14px}

    label{display:block; font-weight:600; margin:0 0 6px}
    .field input{
      width:100%; padding:14px 12px; border:1px solid var(--line); border-radius:12px;
      outline:none; background:#fff; font-size:15px; color:var(--ink);
    }
    .field input:focus{border-color:var(--accent); box-shadow:0 0 0 4px rgba(109,40,217,.12)}

    .btn-row{display:flex; gap:10px; flex-wrap:wrap; margin:16px 0 8px}
    .btn{appearance:none; border:1px solid var(--line); background:#fff; color:var(--ink);
      padding:12px 14px; border-radius:999px; cursor:pointer; font-weight:600; font-size:14px;
      transition:all .15s ease; box-shadow:0 2px 0 rgba(17,17,17,.04);
    }
    .btn:hover{transform:translateY(-1px); box-shadow:0 6px 14px rgba(17,17,17,.06)}
    .btn.primary{background:var(--accent); color:var(--accent-ink); border-color:transparent}
    .btn.black{background:#111111; color:#ffffff; border-color:#111111}
    .btn[disabled]{opacity:.55; cursor:not-allowed; transform:none; box-shadow:none}

    .actions{display:flex; gap:10px; align-items:center; margin:10px 0 8px}
    .hint{color:var(--muted); font-size:13px}

    .preview{
      margin-top:8px; padding:18px; border-radius:16px; background:#fff;
      border:2px dashed var(--line);
    }
    .preview h3{margin:0 0 10px; font-size:16px}
    .preview .frame{background:#fff; border:1px solid var(--line); border-radius:12px; padding:18px}

    /* 중앙 토스트 */
    .toast{
      position:fixed; top:50%; left:50%;
      transform:translate(-50%,-40%) scale(.98);
      background:#111; color:#fff; border-radius:12px;
      padding:14px 18px; opacity:0; transition:all .2s ease;
      text-align:center; z-index:9999; box-shadow:0 10px 30px rgba(0,0,0,.25);
      max-width:86vw;
      visibility:hidden;
      pointer-events:none;
    }
    .toast.show{opacity:1; transform:translate(-50%,-50%) scale(1)
               visibility:visible;}
    .toast .note{margin-top:8px; font-size:12px; color:#d1d5db; line-height:1.4}

    .hr{height:1px; background:var(--line); margin:18px 0}

    /* 날짜 입력 2열 */
    .grid.dates{
      display:grid; grid-template-columns:1fr 1fr; gap:18px;
      align-items:start; margin:8px 0 0px;
    }
    .datebox{display:block; border:1px solid var(--line); border-radius:12px; padding:10px; background:#fff;}
    .date-row{display:flex; align-items:center; gap:6px; padding:6px 8px; border-radius:8px;}
    .date-row + .date-row{margin-top:8px; background:#fafafa;}
    .date-row input, .date-row select{
      border:1px solid var(--line); border-radius:10px; padding:8px 10px; font-size:14px;
    }
    .date-row input:focus, .date-row select:focus{
      outline:none; border-color:var(--accent); box-shadow:0 0 0 3px rgba(109,40,217,.12);
    }
    .date-row .y{width:86px; text-align:center;}
    .date-row .m,.date-row .d{width:56px; text-align:center;}
    .date-row .h,.date-row .i{width:56px; text-align:center;}
    .date-row .w{min-width:84px;}
    .date-row .sep,.date-row .colon{color:#6b7280;}

    @media (max-width:900px){
      .grid.dates{grid-template-columns:1fr;}
    }


.dates-after{
  display:grid; grid-template-columns:1fr 1fr; gap:18px; margin-top:14px;
}
.dates-after .intern-field{
  grid-column:2; display:flex; align-items:center; gap:8px;
}
.dates-after .intern-field .intern-label{
  display:inline-flex; align-items:center;
  margin:0; font-weight:600;
}
#isIntern{ width:13px; height:13px; }


@media (max-width:900px){
  .dates-after{ grid-template-columns:1fr; }
  .dates-after .intern-field{ grid-column:1; }
}

    /* ================================================= */
/* ▼▼▼ '인턴십' 체크박스 레이아웃 조정을 위해 이 코드를 추가 ▼▼▼ */
/* ================================================= */

/* '인턴십' 라벨과 체크박스를 감싸는 컨테이너 스타일 */
.intern-inline {
  display: flex; /* 자식 요소(라벨, 체크박스)를 가로로 배치합니다. */
  align-items: center; /* 세로 방향으로 중앙에 정렬합니다. */
  gap: 8px; /* 라벨과 체크박스 사이에 8px의 간격을 줍니다. */
}

/* '인턴십' 라벨에만 적용될 스타일 (기존의 block 속성 덮어쓰기) */
.intern-inline .intern-label {
  display: inline-block; /* 라벨이 한 줄을 다 차지하지 않도록 변경합니다. */
  margin: 0; /* 라벨 아래쪽의 기존 여백을 제거합니다. */
}
   /* =================== 히스토리 기능 CSS 추가 =================== */
.main-wrapper {
  display: flex;
  gap: 24px;
  max-width: 1500px;
  margin: 0 auto;
  align-items: flex-start;
}
.container {
  flex: 1; /* 남는 공간을 모두 차지 */
  min-width: 0;
}
.history-panel {
  width: 320px;
  flex-shrink: 0;
  background: var(--card);
  border: 1px solid var(--line);
  border-radius: 24px;
  padding: 24px;
  box-shadow: 0 10px 30px rgba(0,0,0,.03);
  position: sticky; /* 스크롤してもついてくるように */
  top: 24px;
}
.history-panel h2 {
  margin: 0 0 16px;
  font-size: 18px;
}
.history-panel ul {
  list-style: none;
  margin: 0;
  padding: 0;
  max-height: 70vh;
  overflow-y: auto;
}
.history-panel li {
  margin: 0;
  padding: 0;
}
.history-panel .history-item {
  display: block;
  padding: 12px;
  border-radius: 10px;
  cursor: pointer;
  border-bottom: 1px solid var(--line);
  transition: background .15s ease;
}
.history-panel .history-item:hover {
  background: #f3f4f6;
}
.history-panel .history-item strong {
  font-weight: 600;
  color: var(--ink);
  display: block;
}
.history-panel .history-item .meta {
  font-size: 12px;
  color: var(--muted);
  margin-top: 4px;
}
.history-panel .history-item .meta .key {
  font-weight: 600;
}

@media (max-width: 1200px) {
  .main-wrapper {
    flex-direction: column;
  }
  .history-panel {
    width: 100%;
    position: static;
  }
} 
  /* ▼▼▼ [추가] 자동화 버튼 스타일 ▼▼▼ */
    .schedule-button { 
      display: inline-block; 
      background-color: #5E51FF; 
      color: #ffffff; 
      padding: 12px 20px; 
      margin: 16px 0; 
      font-size: 16px; 
      font-weight: bold; 
      text-decoration: none; 
      border-radius: 8px; 
      text-align: center; 
    }

    /* 과제 선택 옆 초기화 버튼 */
.select-with-reset{
  display:flex;
  gap:10px;
  align-items:center;
}
.select-with-reset select{
  flex:1;
  min-width:0;
}

.icon-btn{
  width:var(--control-h);
  height:var(--control-h);
  border:1px solid var(--line);
  background:#fff;
  border-radius:12px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 2px 0 rgba(17,17,17,.04);
  transition:all .15s ease;
}
.icon-btn:hover{
  transform:translateY(-1px);
  box-shadow:0 6px 14px rgba(17,17,17,.06);
}
.icon-btn img{
  width:18px;
  height:18px;
  opacity:.9;
}

  </style>
</head>
<body>
  <div class="main-wrapper">

    <div class="container">
      <h1>Featuring Recruit 메일 서식</h1>
      <p class="sub">아래 3가지만 입력한 뒤, 원하는 단계 버튼을 누르세요. 하단 미리보기에서 <strong>서식 복사</strong>를 클릭하면 Gmail 본문(HTML)으로 그대로 붙여넣을 수 있습니다.</p>

      <div class="grid">
        <div class="field">
          <label for="name">지원자명</label>
          <input id="name" type="text" placeholder="예: 홍길동" />
        </div>
        <div class="field">
          <label for="position">포지션명</label>
          <input id="position" type="text" placeholder="예: HR Manager" />
        </div>
        <div class="field">
          <label for="taskurlSelect">과제 선택</label>
          <div class="select-with-reset">
          <select id="taskurlSelect" class="field input" style="padding: 14px 12px; height: auto;">
            <option value="">과제 없음</option>
            <option value="https://featuring-corp.atlassian.net/wiki/external/ODc0OTc2ODRlNGExNGY0YjhkZWY4ZGEzNzNiNTA0Y2Q">DE 과제</option>
            <option value="https://featuring-corp.atlassian.net/wiki/external/M2E4MzhlMGNhYTUzNDAwNmI2MTkyZmZiOGQxZTZkYTU">BE (Jr) 과제</option>
            <option value="https://featuring-corp.atlassian.net/wiki/external/OTZmYzQ0ZWNiMWJiNDk1MDliMWI2N2YzN2IzZGQ1NTc">BE (Mid&Sr) 과제</option>   
            <option value="https://featuring-corp.atlassian.net/wiki/external/NTU4ODQxZTc1MTQyNDM4OWEzYTEzZTdjNTcyNWM1M2U">AI 과제</option>
            <option value="https://featuring-corp.atlassian.net/wiki/external/OTFkOTQ3YmFhZGI4NGM1ZWJhYmFlOTUwZTAzMWVjM2U">PM 과제</option>
            <option value="https://featuring-corp.atlassian.net/wiki/external/OTAzZThhODIxZmM5NGIyZmE2ODc3MWU2NDQwMjAwMjQ">FE 과제</option>
    </select>
    <button type="button" id="resetBtn" class="icon-btn" aria-label="입력값 초기화">
      <img src="assets/reset.png" alt="" />
    </button>
  </div>
        </div>
      </div>

      <div class="grid dates">
        <div class="field">
          <label>제안일자</label>
          <div class="datebox">
            <div class="date-row"> <input id="p1y" class="y" placeholder="yyyy" /> <span class="sep">-</span> <input id="p1m" class="m" placeholder="mm" /> <span class="sep">-</span> <input id="p1d" class="d" placeholder="dd" /> <select id="p1w" class="w"> <option value="">(요일)</option><option>월</option><option>화</option><option>수</option> <option>목</option><option>금</option><option>토</option><option>일</option> </select> <input id="p1h" class="h" placeholder="24" /> <span class="colon">:</span> <input id="p1i" class="i" placeholder="00" /> </div>
            <div class="date-row"> <input id="p2y" class="y" placeholder="yyyy" /> <span class="sep">-</span> <input id="p2m" class="m" placeholder="mm" /> <span class="sep">-</span> <input id="p2d" class="d" placeholder="dd" /> <select id="p2w" class="w"> <option value="">(요일)</option><option>월</option><option>화</option><option>수</option> <option>목</option><option>금</option><option>토</option><option>일</option> </select> <input id="p2h" class="h" placeholder="24" /> <span class="colon">:</span> <input id="p2i" class="i" placeholder="00" /> </div>
            <div class="date-row"> <input id="p3y" class="y" placeholder="yyyy" /> <span class="sep">-</span> <input id="p3m" class="m" placeholder="mm" /> <span class="sep">-</span> <input id="p3d" class="d" placeholder="dd" /> <select id="p3w" class="w"> <option value="">(요일)</option><option>월</option><option>화</option><option>수</option> <option>목</option><option>금</option><option>토</option><option>일</option> </select> <input id="p3h" class="h" placeholder="24" /> <span class="colon">:</span> <input id="p3i" class="i" placeholder="00" /> </div>
          </div>
        </div>
        <div class="field field-confirm">
          <label>확정일자</label>
          <div class="datebox">
            <div class="date-row"> <input id="c1y" class="y" placeholder="yyyy" /> <span class="sep">-</span> <input id="c1m" class="m" placeholder="mm" /> <span class="sep">-</span> <input id="c1d" class="d" placeholder="dd" /> <select id="c1w" class="w"> <option value="">(요일)</option><option>월</option><option>화</option><option>수</option> <option>목</option><option>금</option><option>토</option><option>일</option> </select> <input id="c1h" class="h" placeholder="24" /> <span class="colon">:</span> <input id="c1i" class="i" placeholder="00" /> </div>
          </div>
        </div>
      </div>

      <div class="dates-after">
        <div class="intern-inline">
          <label for="isIntern" class="intern-label">인턴십</label>
          <input id="isIntern" type="checkbox" />
        </div>
      </div>

      <div class="btn-row" aria-label="단계 버튼">
        <button type="button" button class="btn js-template" data-key="assignment_schedule">과제 일정</button>
        <button type="button" button class="btn js-template" data-key="task">과제전형</button> 
        <button type="button" button class="btn js-template" data-key="interview1">1차 인터뷰</button> 
        <button type="button" button class="btn js-template" data-key="interviewFinal">최종 인터뷰</button> 
        <button type="button" button class="btn js-template" data-key="scheduleConfirm">일정 확정</button> 
        <button type="button" button class="btn js-template" data-key="reference">레퍼런스 체크</button> 
        <button type="button" button class="btn js-template" data-key="finalNotice">처우협의 및 오퍼레터</button> 
        <button type="button" button class="btn js-template" data-key="onboarding">입사 안내</button> 
        <button type="button" button class="btn black js-template" data-key="reject">불합격</button>
      </div>

      <div class="actions">
        <button id="copyBtn" class="btn primary" disabled>서식 복사</button>
        <button id="copySubjectBtn" class="btn" disabled>제목 복사</button>
        <span id="subjectPreview" class="hint" aria-live="polite"></span>
      </div>

      <div class="preview">
        <h3>미리보기</h3>
        <div id="preview" class="frame" aria-live="polite">아직 선택된 서식이 없습니다.</div>
      </div>
    </div>

    <aside class="history-panel">
      <h2>최근 내역 불러오기</h2>
      <ul id="historyList">
        </ul>
    </aside>

  </div> <div id="toast" class="toast" role="status" aria-live="polite">클립보드에 복사했습니다.</div>
  <script>
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbz7PjwzvrDR9Vo-jtjih35O27tM7oVMBNg8bRfcne5dkp4Hzfo5CROh9JTCf0_73qK4/exec";
  const ONBOARDING_FORM_URL = "https://forms.google.com/your-form-url"; // 입사 필수 정보/서류 제출 폼 링크
  const CULTURE_GUIDE_URL = "https://teamfeaturing.notion.site/Featuring-Culture-Guide-df09fd30889a42e3845c7802d316b184?source=copy_link"; // 문화 소개서 링크 (원하면 실제 링크로 교체)



 /* ---------- 유틸 ---------- */
  const brandLinkStyle = "color:#111111; text-decoration:underline;";
  function getHeaderImageSrc(){ try { return new URL('assets/process.png', window.location.href).href; } catch(e) { return 'assets/process.png'; } }
  function wrapEmail(contentHtml){ const header = '<div style="margin:0 0 20px 0; text-align:left;"><img src="' + getHeaderImageSrc() + '" width=848" height="135" alt="Featuring Recruit" style="display:block;margin:0;width:848px;height:135px;border:0;"/></div>'; const signoffRe = new RegExp('<p[^>]*>\\s*감사합니다\\.[\\s\\S]*?채용팀\\s*드림\\.?\\s*<\\/p>', 'i'); const injected = signoffRe.test(contentHtml) ? contentHtml.replace(signoffRe, header + '$&') : (header + contentHtml); return '<div style="font-family:Arial, Helvetica, \\"Apple SD Gothic Neo\\", \\"Noto Sans KR\\", \\"Malgun Gothic\\", sans-serif; font-size:14px; color:#111111; line-height:1.7;"><div style="padding:8px 0 16px 0">' + injected + '</div></div>'; }
  function wrapEmailNoHeader(contentHtml){ return '<div style="font-family:Arial, Helvetica, \\"Apple SD Gothic Neo\\", \\"Noto Sans KR\\", \\"Malgun Gothic\\", sans-serif; font-size:14px; color:#111111; line-height:1.7;"><div style="padding:8px 0 16px 0">' + contentHtml + '</div></div>'; }
  function escapeHtml(s){ return String(s||'').replace(/[&<>"]/g, t => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[t]||t)); }
  function roleHtml(v){ const p=(v.position||'').trim(); return escapeHtml(p) + (v.isIntern ? ' (인턴십)' : ''); }
  function subjectRole(v){ const p=(v.position||'').trim(); return p + (v.isIntern ? ' (인턴십)' : ''); }
  function nameFull(v){ return escapeHtml((v.name||'').trim()); }
  function nameBody(v){ const s=(v.name||'').trim(); if(!s) return ''; const space=s.indexOf(' '); const shown = space>0 ? s.slice(space+1) : (s.length>1 ? s.slice(1) : s); return escapeHtml(shown); }
  function normalizeUrl(u){ if(!u) return ''; const s=u.trim(); if(/^(https?:)?\/\//i.test(s)) return s.startsWith('//') ? 'https:'+s : s; return 'https://'+s; }
  function pad2(n){ n=String(n||''); return n.length===1?('0'+n):n; }
  function readDate(prefix){ const y=(document.getElementById(prefix+'y')?.value||'').trim(); const m=(document.getElementById(prefix+'m')?.value||'').trim(); const d=(document.getElementById(prefix+'d')?.value||'').trim(); const w=(document.getElementById(prefix+'w')?.value||'').trim(); const h=(document.getElementById(prefix+'h')?.value||'').trim(); const i=(document.getElementById(prefix+'i')?.value||'').trim(); if(!(y&&m&&d&&w&&h&&i)) return ''; return `${y}-${pad2(m)}-${pad2(d)} (${w}) ${pad2(h)}:${pad2(i)}`; }

  /* 과제 옵션 메타 */
  const TASK_META = { "": { label: "과제 없음", topic: "" }, 
                     "https://featuring-corp.atlassian.net/wiki/external/ODc0OTc2ODRlNGExNGY0YjhkZWY4ZGEzNzNiNTA0Y2Q": { label: "DE 과제", topic: "소셜 미디어 데이터 파이프라인 시스템 설계" }, 
                     "https://featuring-corp.atlassian.net/wiki/external/M2E4MzhlMGNhYTUzNDAwNmI2MTkyZmZiOGQxZTZkYTU": { label: "BE 과제", topic: "대량 DM/메일 전송 시스템 설계" }, 
                     "https://featuring-corp.atlassian.net/wiki/external/NTU4ODQxZTc1MTQyNDM4OWEzYTEzZTdjNTcyNWM1M2U": { label: "AI 과제", topic: "멀티모달 RAG 성능 최적화 시스템 구축" },
                     "https://featuring-corp.atlassian.net/wiki/external/OTZmYzQ0ZWNiMWJiNDk1MDliMWI2N2YzN2IzZGQ1NTc": { label: "BE 과제", topic: "대량 DM/메일 전송 시스템 설계" }, 
                     "https://featuring-corp.atlassian.net/wiki/external/OTFkOTQ3YmFhZGI4NGM1ZWJhYmFlOTUwZTAzMWVjM2U" : { label: "PM 과제", topic: "서비스 전략 및 로드맵 수립" },
                     "https://featuring-corp.atlassian.net/wiki/external/OTAzZThhODIxZmM5NGIyZmE2ODc3MWU2NDQwMjAwMjQ" : { label: "FE 과제", topic: " 고도화된 리스트 테이블 시스템 설계" }                     
                    };
  function getTaskTopicByUrl(u){ if(!u) return ''; const k=normalizeUrl(u); return (TASK_META[k] && TASK_META[k].topic) ? TASK_META[k].topic : ''; }

function generateScheduleLink(vars, key) {
  if (WEB_APP_URL.includes("여기에")) {
    return '#error-url-not-set';
  }

  // ✅ 링크 1개당 고유값(중복 제출 방지용)
  const rid = (crypto && crypto.randomUUID) ? crypto.randomUUID()
            : ('rid_' + Date.now() + '_' + Math.random().toString(16).slice(2));

  const params = new URLSearchParams({
    name: vars.name,
    position: vars.position,
    stage: templateKeys[key] || key,
    dates: vars.proposeDates.join(','),
    rid: rid,                // ✅ 추가
    v: new Date().getTime()
  });

  const destUrl = `${WEB_APP_URL}?${params.toString()}`;

  // ✅ 계정 선택 화면 먼저 띄우기
  const chooserUrl =
    "https://accounts.google.com/AccountChooser" +
    "?continue=" + encodeURIComponent(destUrl) +
    "&prompt=select_account";

  return chooserUrl;
}


// ▼▼▼ 이 함수 부분을 아래 내용으로 완전히 새로 교체하세요 ▼▼▼
// vars 데이터를 받아서 버튼 HTML을 만드는 함수
function getScheduleButtonHtml(vars, key) {
  if (['interview1', 'interviewFinal', 'assignment_schedule'].includes(key) && vars.proposeDates.length > 0) {
    
    // 1. 원본 vars 데이터를 복사해서 processedVars를 만듭니다. (...vars 그대로 입력)
    let processedVars = { ...vars }; 

    // 2. 만약 누른 버튼이 '과제 일정'이라면?
    if (key === 'assignment_schedule') {
      // 복사본에 들어있는 날짜들에서 시간만 찾아 '09:00'으로 강제로 바꿉니다.
      processedVars.proposeDates = vars.proposeDates.map(dateStr => 
        dateStr.replace(/\d{2}:\d{2}$/, "09:00")
      );
    }

    // 3. 수정된 복사본(processedVars)을 사용해 링크를 생성합니다.
    const link = generateScheduleLink(processedVars, key);
    
    // URL 설정 체크
    if (link === '#error-url-not-set') {
      return '<p style="color:red; font-weight:bold;">[오류] 스크립트 상단의 WEB_APP_URL을 먼저 입력해주세요!</p>';
    }
    
    // 버튼 HTML 반환
    return `<a href="${link}" target="_blank" style="display: inline-block; background-color: #5E51FF; color: #ffffff; padding: 12px 20px; margin: 16px 0; font-size: 16px; font-weight: bold; text-decoration: none; border-radius: 8px; text-align: center;">📅 가능 일정 선택하기</a>`;
  }
  
  // 조건에 맞지 않으면 빈 문자열 반환
  return '';
}
// ▲▲▲ 여기까지 교체 ▲▲
    /* 템플릿들 (문구 변경 없음) */
    const templates = {
    assignment_schedule: (v, k) => wrapEmail(`
      <p style="margin:0 0 3px 0;"><strong>[Featuring]</strong></p>
      <p style="margin:0 0 3px 0;">안녕하세요, ${nameFull(v)}님.</p>
      <p style="margin:0 0 14px 0;">피처링 채용팀입니다.</p>

    <p style="margin:0 0 3px 0;">먼저 저희 회사와  ${ v.isIntern ? `인턴십 프로그램` : `${escapeHtml(v.position)} 포지션` }에 관심 가져주시고 지원해주셔서 감사합니다.</p>
    <p style="margin:0 0 3px 0;">제출해 주신 이력서와 경력 사항을 검토한 결과,</p> 
    <p style="margin:0 0 3px 0;">${nameBody(v)}님의 역량과 경험이 해당 포지션에 적합하다고 판단되어 과제 전형을 진행하고자 합니다.</p>
    <p style="margin:0 0 14px 0;">과제는 진행 당일 유의 사항과 함께 안내 되며, 가능한 일정 확인을 위해 메일로 연락드리게 되었습니다.</p>
  
      <p style="margin:0 0 3px 0;"><strong>[진행 안내]</strong></p>
      <div style="padding-left:5px; margin:0 0 3px 0;">
        <p style="margin:0 0 3px 0;">- 유형 : 과제 전형</p>
        <p style="margin:0 0 3px 0;">- 포지션 : ${roleHtml(v)}</p>
        <p style="margin:0 0 3px 0;">- 일시 : 하단 버튼을 눌러 가능한 일정을 제출해주세요.<br />(*링크가 열리지 않는다면, 시크릿 창에서 열어보세요.)</p> 
    </div>
    ${getScheduleButtonHtml(v, k)}
    <p style="margin:0 0 3px 0;">혹시 안내드린 버튼을 통한 일정 선택이 어려우시다면, 본 메일로 가능한 시간대를 회신 부탁드립니다.<br />
    과제 전형 제출일은 직무에 따라 상이하며, 기본적으로 시작 당일 23:59까지 제출이 원칙입니다. (*FE의 경우, 3일 내 제출 권장.) <br />
    또 후보자 분께서 오로지 과제에 집중하실 수 있도록 휴일 진행을 제안드리고 있으며, 다른 일자도 괜찮으시면 편하게 회신 바랍니다. :)</p>
    <p style="margin:0 0 14px 0;">감사합니다.<br />피처링 채용팀 드림.</p>
    
    
  `),
      
      task: (v) => { const role = roleHtml(v); return wrapEmail(`
        <p style="margin:0 0 3px 0;"><strong>[Featuring]</strong></p>
        <p style="margin:0 0 3px 0;">안녕하세요. ${nameFull(v)}님. :)</p>
        <p style="margin:0 0 14px 0;">피처링 채용팀입니다.</p>

        <p style="margin:0 0 3px 0;">먼저 당사와 ${role} 포지션에 관심 가져주시고 지원해주셔서 감사합니다.</p>
        <p style="margin:0 0 14px 0;">과제는 실제 업무와 유사한 상황을 기반으로 구성되어 있습니다. 목표는 아키텍처 설계 및 기술적 의사결정 능력을 평가하기 위함입니다.</p>

        <p style="margin:0 0 3px 0;"><strong>[과제 전형 안내]</strong></p>
        <div style="padding-left:8px; margin:0 0 3px 0;">
        <p style="margin:0 3px 3px 0;">✅ <strong>과제 주제</strong> : ${escapeHtml(v.taskTopic)}</p>
        ${v.taskurl ? `<p style="margin:0 3px 3px 0;">✅ <strong>과제 링크</strong> : <a href="${v.taskurl}" style="${brandLinkStyle}"><span style="color:#3d85c6">URL</span></a></p>` : ''}
        <p style="margin:3px 0 3px 0;">✅ <strong>제출 형식</strong> :</p>
        <ul style="margin:0 0 3px 18px; padding:0;">
        <li>구성을 한눈에 볼 수 있는 도식(Flowchart, Architecture Diagram 등)을 포함해주세요.</li>
        <li>데이터 관리부터 비즈니스 로직 구현 단계까지, 각 과정에서 고려해야 할 요소(성능, 확장성, 보안, 비용 효율성, 모니터링 등)에 대해 파이프라인을 기술해주시기 바랍니다.</li>
        <li>문서 형식은 PPT, PDF, Markdown 등 자유롭게 선택하시면 됩니다.</li>
  </ul>

<p style="margin:3px 0 3px 0;">✅ <strong>마감 기한</strong> :</p>
    <ul style="margin:0 0 14px 18px; padding:0;">
      <li><strong>금일 자정(${ 
        v.confirmDate 
        ? escapeHtml(v.confirmDate.replace(/\d{2}:\d{2}$/, "23:59")) // ★ 시간만 23:59로 치환
        : `<span style="color:#6b7280;">{날짜를 입력하세요}</span>` 
      })전 까지</strong> 회신 부탁드립니다.</li>
      <li>해당 메일에 [전체 답장] 또는 recruit@featuring.in으로 제출해주시면 됩니다.</li>
    </ul>
</div>
        <p style="margin:0 0 3px 0;">제출하신 과제는 내부 기술 리드 및 개발팀과 함께 검토할 예정이며, 결과는 제출일로부터 영업일 기준 3일 전까지 안내 드리겠습니다.</p>
        <p style="margin:0 0 3px 0;">과제 진행 중 궁금하신 사항이 있거나 제출 기한에 어려움이 있으실 경우, 언제든 편하게 해당 메일로 연락 부탁드립니다. :)</p>

        <p style="margin:0 0 14px 0; color:#b91c1c; font-style:italic; font-size:12px;">
        (*해당 과제는 피처링의 자산이므로 외부 및 제3자 유출 시 채용 과정이 취소되며, 별도의 조치 될 수 있음을 사전에 안내드립니다.)
        </p>

  <p style="margin:0;">감사합니다.<br />피처링 채용팀 드림.</p>
`); },

      interview1: (v,k) => wrapEmail(`
  <p style="margin:0 0 3px 0;"><strong>[Featuring]</strong></p>
  <p style="margin:0 0 3px 0;">안녕하세요, ${nameFull(v)}님.</p>
  <p style="margin:0 0 14px 0;">피처링 채용팀입니다.</p>

  <p style="margin:0 0 3px 0;">먼저 저희 회사와  ${ v.isIntern ? `인턴십 프로그램` : `${escapeHtml(v.position)} 포지션` }에 관심 가져주시고 지원해주셔서 감사합니다.</p>
  <p style="margin:0 0 3px 0;">제출해 주신 이력서와 경력 사항을 검토한 결과,</p> 
  <p style="margin:0 0 3px 0;">${nameBody(v)}님의 역량과 경험이 해당 포지션에 적합하다고 판단되어 1차 인터뷰를 진행하고자 합니다.</p>
  <p style="margin:0 0 14px 0;">인터뷰는 대면으로 진행되며, 가능한 일정 확인을 위해 메일로 연락드리게 되었습니다.</p>

  <p style="margin:0 0 3px 0;"><strong>[진행 가능 일정/장소]</strong></p>
  <div style="padding-left:5px; margin:0 0 3px 0;">
  <p style="margin:0 0 3px 0;">- 유형 : 1차 인터뷰 (실무진 참여)</p>
  <p style="margin:0 0 3px 0;">- 포지션 : ${roleHtml(v)}</p>
  <p style="margin:0 0 3px 0;">- 장소 : 서울 강남구 테헤란로 129, 빗썸금융타워 8층</p>
  <p style="margin:0 0 3px 0;">- 일시 : 하단 버튼을 눌러 가능한 일정을 제출해주세요.<br />(*링크가 열리지 않는다면, 시크릿 창에서 열어보세요.)</p> </div>
  ${getScheduleButtonHtml(v, k)}
  <p style="margin:0 0 3px 0;">혹시 해당 일시 및 시간대가 어려우시다면, 가능한 시간을 2~3개 일정정도 함께 공유해 주시면 조율하여 진행하도록 하겠습니다.</p>
  <p style="margin:0 0 14px 0;">추가로 인터뷰에 앞서 준비해야 할 사항이나 궁금한 점이 있으시다면 언제든지 편하게 연락 부탁 드립니다. :)</p>
  
  <p style="margin:0;">감사합니다.<br />피처링 채용팀 드림.</p>
`),

      interviewFinal: (v,k) => wrapEmail(`
  <p style="margin:0 0 3px 0;"><strong>[Featuring]</strong></p>
  <p style="margin:0 0 3px 0;">안녕하세요, ${nameFull(v)}님.</p>
  <p style="margin:0 0 14px 0;">피처링 채용팀입니다.</p>

  <p style="margin:0 0 3px 0;">우선 지난 인터뷰에 흔쾌히 응해주시고, 소중한 시간 할애하여 적극 참여해주신 점 진심으로 감사드립니다.</p>
  <p style="margin:0 0 14px 0;">${nameBody(v)}님께서 1차 인터뷰를 통해 보여주신 역량과 지금까지 쌓아오신 커리어에 대해 인상 깊게 생각하여 <strong>최종 인터뷰 제안</strong>드리고자 합니다.</p>

  <p style="margin:0 0 3px 0;"><strong>[진행 가능 일정/장소]</strong></p>
  <div style="padding-left:5px; margin:0 0 3px 0;">
  <p style="margin:0 0 3px 0;">- 유형 : 2차(최종) 인터뷰 (C-level 참여)</p>
  <p style="margin:0 0 3px 0;">- 포지션 : ${roleHtml(v)}</p>
  <p style="margin:0 0 3px 0;">- 장소 : 서울 강남구 테헤란로 129, 빗썸금융타워 8층</p>
  <p style="margin:0 0 3px 0;">- 일시 : 하단 버튼을 눌러 가능한 일정을 제출해주세요.<br />(*링크가 열리지 않는다면, 시크릿 창에서 열어보세요.)</p> </div>
  ${getScheduleButtonHtml(v, k)}
  <p style="margin:0 0 3px 0;">지난번처럼 혹시 해당 일시 및 시간대가 어려우시다면, 가능한 시간을 함께 공유해 주시면 조율하여 진행하도록 하겠습니다.</p>
  <p style="margin:0 0 14px 0;">${nameFull(v)}님의 뛰어난 역량을 더 깊게 알아가 볼 수 있을 자리가 될 것 같아 기쁘게 생각하고 있습니다. :)</p>

  <p style="margin:0;">감사합니다.<br />피처링 채용팀 드림.</p>
`),

      scheduleConfirm: (v) => { const role = roleHtml(v); return wrapEmail(`
  <p style="margin:0 0 3px 0;"><strong>[Featuring]</strong></p>
  <p style="margin:0 0 3px 0;">빠르게 일정 확인 후 회신주셔서 감사합니다. ${nameBody(v)}님.</p>
  <p style="margin:0 0 14px 0;">말씀주신 일자로 확정하여 안내 도와드리겠습니다. :)</p>

  <p style="margin:0 0 3px 0;"><strong>[확정 일정 안내]</strong></p>
    <div style="padding-left:5px; margin:0 0 3px 0;">
    <p style="margin:0 0 3px 0;">- 포지션 : ${roleHtml(v)}</p>
    <p style="margin:0 0 3px 0;">- 장소 : 서울 강남구 테헤란로 129, 빗썸금융타워 8층</p>
      <div style="padding-left:8px; margin:0 0 3px 0;">
       <p style="margin:0 5px 3px 0;">✅ L(로비)층에 도착하시어 아래 연락처로 연락주시면 담당자가 직접 안내 도와드리겠습니다.</p>
       <p style="margin:0 5px 3px 0;">❓ L층은 정문으로 방문하시게 될 경우, 에스컬레이터를 타고 한 층 올라오셔야 합니다.</p>    
       <p style="margin:0 5px 3px 0;">🙋 담당자 연락처 : 010-7376-0490</p> </div>
    <div style="padding-left:5px; margin:0 0 3px 0;">
    <p style="margin:0 0 3px 0;">
  - 일시 :
  ${ v.confirmDate
      ? escapeHtml(v.confirmDate)
      : `<span style="color:#6b7280;">{날짜를 입력하세요}</span>` }
<br />- 진행 시간 : 약 1시간 ~ 소요 예정
  </div>
</div>
    <p style="margin:0 0 3px 0;">혹여 확정된 일자가 다가오기 전 부득이 일정 변경이 필요하신 경우, 해당 메일로 회신 부탁드립니다.</p>
    <p style="margin:0 0 14px 0;">인터뷰 당일에 웃는 얼굴로 뵙겠습니다. :)</p>
  
   <p style="margin:0;">감사합니다.<br />피처링 채용팀 드림.</p>
`); },

      reference: (v) => wrapEmail(`
  <p style="margin:0 0 3px 0;"><strong>[Featuring]</strong></p>
  <p style="margin:0 0 3px 0;">안녕하세요, ${nameFull(v)}님.</p>
  <p style="margin:0 0 14px 0;">피처링 채용팀입니다.</p>

  <p style="margin:0 0 3px 0;">다시 한번 피처링 채용 프로세스에 관심 가져주시고, 시간 내어 일정에 참여해주셔서 감사드립니다.</p> 
  <p style="margin:0 0 3px 0;">다음 전형인 레퍼런스 체크에 대한 안내드리고자 합니다.</p> 
  <p style="margin:0 0 14px 0;">레퍼런스 체크 전형은 아래와 같이 진행될 예정입니다.</p> 

  <p style="margin:0 0 3px 0;"><strong>[레퍼런스 체크 전형 안내]</strong></p>
  <div style="padding-left:5px; margin:0 0 3px 0;">
  <p style="margin:0 0 3px 0;">- 대상 : 지정 1~2명 (팀 리더 우선)</p>
  <p style="margin:0 0 3px 0;">- 진행방식 : 유선 인터뷰</p>
  <p style="margin:0 0 14px 0;">- 진행일정 : 대상자들과 개별 논의하여 차주까지 진행 예정</p>
  </div>

  <p style="margin:0 0 3px 0;">레퍼런스 체크 진행을 위하여 전자 서명을 통해 동의서 서명을 요청드릴 예정이며,</p> 
  <p style="margin:0 0 14px 0;">레퍼런스 체크 진행에 대한 동의 여부와 진행을 원하시는 지정인 1~2명의 정보(이름, 관계, 전화번호)를 포함하여 해당 동의서 작성을 부탁드립니다.</p> 

  <p style="margin:0 0 14px 0;">꼭 직전 회사의 동료일 필요는 없지만 기본적으로  ${nameBody(v)}님님과 최소한 3개월 이상 긴밀하게 협업을 한 경험이 있는 동료들로 전달을 부탁 드리며, 협업 했던 직속 상사(C-level)를 필수로 1명 포함하여 전달해주세요.</p> 

  <p style="margin:0 0 14px 0;">현재 재직 중인 회사에 이직 및 퇴사 사실을 밝히지 않아, 해당 조직의 동료 분에게 레퍼런스 체크가 진행되지 않기를 바라시는 경우에는 본 메일에 말씀해주시면 참고하여 프로세스 진행하도록 하겠습니다.</p> 

  <p style="margin:0 0 14px 0; color:#b91c1c; font-style:italic; font-size:12px;">
  (*본 레퍼런스 체크를 통해 얻은 정보는 당사의 채용 이외에 다른 목적으로 사용되지 않음을 안내 드립니다.)
  </p>

  <p style="margin:0 0 14px 0;">관련하여 궁금한 점은 언제든 편하게 해당 메일을 통해 문의 부탁드립니다.</p> 
  
  <p style="margin:0;">감사합니다.<br />피처링 채용팀 드림.</p>
`),
      finalNotice: (v) => wrapEmail(`
      <p style="margin:0 0 3px 0;"><strong>[Featuring]</strong></p>
      <p style="margin:0 0 3px 0;">안녕하세요, ${nameFull(v)}님.</p>
      <p style="margin:0 0 14px 0;">피처링 채용팀입니다.</p>

      <p style="margin:0 0 3px 0;">길었던 피처링의 채용 프로세스에 적극 응해주시고, 흔쾌히 대면 인터뷰에 참석해주시어 감사드립니다.</p>
      <p style="margin:0 0 3px 0;">최종 인터뷰 결과, <strong>합격을 안내드리며 동시에 오퍼 레터 전달</strong>드립니다.</p>
      <p style="margin:0 0 14px 0;">🎉 최종 합격을 진심으로 축하드립니다. :)</p>
      <p style="margin:0 3px 14px 0; color:#666666; font-style:italic; font-size:12px;">
        *아래 오퍼레터에 승낙하지 않으면 입사 확정된 것으로 간주하지 않습니다. 상호 협의 하에 아래 내용이 변경될 수 있습니다.</p>

      <p style="margin:0 0 3px 0;"><strong>[제안 내용 및 안내 사항]</strong></p>
      <p style="margin:0 0 3px 0;"><strong>1) 제안 연봉</strong></p>
      <div style="padding-left:5px; margin:0 0 3px 0;">
      <p style="margin:0 3px 3px 0;">${ v.isIntern ? `- 지급 보수 : 프로그램 규정에 따름.` : `- 처우안 : 연봉 {$,$$$}만원(세전)`}</p>
      </div>

      <p style="margin:0 0 3px 0;"><strong>2) 입사 일자</strong></p>
      <div style="padding-left:5px; margin:0 0 3px 0;">
      <p style="margin:0 0 3px 0;">
      - 예정일자 :
    ${ v.confirmDate
      ? escapeHtml(v.confirmDate)
      : `<span style="color:#6b7280;">{날짜를 입력하세요}</span>` }
</p>
  <p style="margin:0 3px 3px 0;">${ v.isIntern ? `` : `- 개인 상황에 따라 상호 협의 가능한 사항입니다.`}</p>
  <p style="margin:0 3px 3px 0;">${ v.isIntern ? `` : `- 피처링은 시용기간 3개월이 있으며, 급여는 100% 지급됩니다.`}</p>
  <p style="margin:0 0 14px 0;">${ v.isIntern ? `- 인턴십 프로그램 종료 후 당사의 방침 및 평가에 따라 정규직 전환을 제안드릴 수 있습니다.` : `- 고용형태와 무관하게 모든 임직원의 첫 계약은 시용기간 3개월 계약직 계약 후, 시용 통과 후 정규직 계약으로 전환하고 있는 점 참고 부탁드립니다.`}<br />
  (*모든 인사는 최초입사일을 기준으로 산정됩니다.)</p>
  </div>

  <p style="margin:0 0 3px 0;"><strong>3) 소속 부서 및 업무 안내</strong></p>
    <div style="padding-left:5px; margin:0 0 3px 0;">
  <p style="margin:0 3px 3px 0;">- 소속 : </p>
  <p style="margin:0 3px 3px 0;">- 주요 업무 : ${ v.isIntern ? `(인턴십)` : ``}</p>
    <div style="padding-left:8px; margin:0 0 3px 0;">
    <p style="margin:0 8px 3px 0;">①</p>
    <p style="margin:0 8px 3px 0;">②</p>
    <p style="margin:0 8px 3px 0;">③</p>
    <p style="margin:0 8px 14px 0;">④</p>
  </div>
</div>

  <p style="margin:0 0 3px 0;">해당 오퍼레터에 동의 및 합류 여부 회신 부탁드리며, 이후 안내 사항은 별도로 메일 보내드리겠습니다 :)</p>
  <p style="margin:0 3px 14px 0;">궁금하신 부분은 언제든 편하게 말씀 부탁드리며, 함께 만들어 갈 성장을 기대하고 있겠습니다.</p>
    
  <p style="margin:0;">감사합니다.<br />피처링 채용팀 드림.</p>
`),

reject: (v) => wrapEmail(`
 <p style="margin:0 0 3px 0;"><strong>[Featuring]</strong></p>
  <p style="margin:0 0 3px 0;">안녕하세요, ${nameFull(v)}님.</p>
  <p style="margin:0 0 14px 0;">피처링 채용팀입니다.</p>

  <p style="margin:0 0 3px 0;">먼저 피처링에 지원해주셔서 감사합니다.</p>
  <p style="margin:0 0 14px 0;">혹시 채용 프로세스가 진행되는 중 저희가 의도치 않게 불편을 드린 점은 없었는지 여러모로 마음이 쓰입니다.</p>
  
  <p style="margin:0 0 14px 0;">${nameBody(v)}님께는 안타깝게도 이번 지원에서는 전형 합격의 기쁜 소식을 전해드리지 못하게 되었습니다.</p>

  <p style="margin:0 0 14px 0;">언젠가부터 취업과 이직 그 자체가 목적이고 꿈이 되어버린 삭막한 취업 환경 가운데 매일을 고군분투하며 자신과의 싸움을 이겨내는 여러분들께 그 어떤 말로도 온전한 위로를 건넬 수 없다는 것을 익히 알고 있습니다.</p>

  <p style="margin:0 0 14px 0;">비록 이번 전형을 통해 ${nameBody(v)}님과 좋은 인연으로 함께 하지는 못하지만,<br />스스로 꿈꾸는 밝은 미래는 반드시 실현되리라 믿으며 진심 어린 응원의 마음을 전해드립니다.</p>

  <p style="margin:0 0 14px 0;">향후 또 다른 경로로 ${nameBody(v)}님을 다시 만나 뵐 수 있기를 바라며 앞으로 펼쳐질 삶에 성장과 행복이 함께하기를 기원합니다.</p>

  <p style="margin:0 0 14px 0;"></p>

  <p style="margin:0 0 3px 0;">언제나 건강 유의하시고, 빛나는 하루 되시기 바랍니다.<br />언젠가 인연이 닿아 다시 뵐 수 있을 날을 고대하며, ${nameBody(v)}님의 앞길에 꽃길만이 가득하길 기원합니다.</p>
  <p style="margin:0;">감사합니다.<br />피처링 채용팀 드림.</p>
`),

      onboarding: (v) => {
        const name = escapeHtml((v.name || '').trim());
        const position = escapeHtml((v.position || '').trim());

          // 확정일자(c1)에서 "YYYY-MM-DD (요일)"까지만 보여주고, 시간은 10시로 고정 표기
        const startDate = v.confirmDate
          ? escapeHtml(v.confirmDate.replace(/\s+\d{2}:\d{2}\s*$/, ''))   // 뒤 "HH:MM" 제거
          : `<span style="color:#6b7280;">{입사일자}</span>`;

        const formUrl = (typeof ONBOARDING_FORM_URL !== 'undefined' && ONBOARDING_FORM_URL)
          ? ONBOARDING_FORM_URL
          : "https://forms.google.com/your-form-url";

        const cultureUrl = (typeof CULTURE_GUIDE_URL !== 'undefined' && CULTURE_GUIDE_URL)
          ? CULTURE_GUIDE_URL
          : "https://teamfeaturing.notion.site/Featuring-Culture-Guide-df09fd30889a42e3845c7802d316b184?source=copy_link";
    
const titleText = v.isIntern
    ? `${nameFull(v)}님, 피처링의 인턴십 합류를<br />진심으로 축하하고 환영합니다.`
    : `${nameFull(v)}님, 피처링의 새로운 구성원이 되신 것을<br />진심으로 축하하고 환영합니다.`;

  const periodBlock = v.isIntern
    ? `
      <div style="margin:0 0 6px 0;">✅ 인턴십 기간 : 3개월</div>
      <div style="margin:10px 0 0 0; color:#4b5563; font-size:13px; line-height:1.7;">
        1) 인턴십 종료 후, 사내 규정에 의거한 평가 및 쌍방 협의를 통해 정규직 전환 계약을 진행할 수 있습니다.<br />
        2) 모든 인사규정은 최초입사일 기준으로 진행됩니다.
      </div>
    `
    : `
      <div style="margin:0 0 6px 0;">✅ <시용기간: 3개월</div>
      <div style="margin:10px 0 0 0; color:#4b5563; font-size:13px; line-height:1.7;">
        1) 시용기간 종료 후, 사내 규정에 의거한 평가 및 쌍방 협의를 통해 수습 해제 절차를 진행합니다.<br />
           이에 근무형태와 무관하게 모든 임직원의 첫 계약은 만 3개월 시용 계약직으로 계약 후, 정규직 계약으로 전환하고 있습니다.<br />
        2) 모든 인사규정은 최초입사일 기준으로 진행됩니다.
      </div>
    `;

  const extraDocsBlock = v.isIntern
    ? '' // 인턴은 해당 인원 서류 섹션 자체 제거
    : `
      <div style="height:14px; line-height:14px; font-size:0;">&nbsp;</div>

      <div style="font-size:15px; font-weight:800; margin:0 0 10px 0;">해당 인원 서류 안내</div>

      <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="width:100%; border:1px solid #e7e9f3; border-radius:12px; overflow:hidden;">
        <tr>
          <td style="padding:10px 12px; background-color:rgba(94,81,255,0.14); font-weight:800; font-size:13px; color:#111111; border-bottom:1px solid #e7e9f3;">구비 서류</td>
          <td style="padding:10px 12px; background-color:rgba(94,81,255,0.14); font-weight:800; font-size:13px; color:#111111; border-bottom:1px solid #e7e9f3;">원본/사본</td>
          <td style="padding:10px 12px; background-color:rgba(94,81,255,0.14); font-weight:800; font-size:13px; color:#111111; border-bottom:1px solid #e7e9f3;">부수</td>
          <td style="padding:10px 12px; background-color:rgba(94,81,255,0.14); font-weight:800; font-size:13px; color:#111111; border-bottom:1px solid #e7e9f3;">비고</td>
        </tr>

        <tr>
          <td style="padding:12px; font-size:13px; border-bottom:1px solid #eef0f7;">☐ 경력증명서</td>
          <td style="padding:12px; font-size:13px; border-bottom:1px solid #eef0f7;">원본</td>
          <td style="padding:12px; font-size:13px; border-bottom:1px solid #eef0f7;">각 1</td>
          <td style="padding:12px; font-size:12px; color:#4b5563; border-bottom:1px solid #eef0f7;">
            최근 5년 내 직장 직인 필요<br />
            <span style="color:#5e51ff; font-weight:800;">*발급이 어려운 경우 사유와 함께 제출</span>
          </td>
        </tr>

        <tr>
          <td style="padding:12px; font-size:13px; border-bottom:1px solid #eef0f7;">☐ 근로소득원천징수영수증</td>
          <td style="padding:12px; font-size:13px; border-bottom:1px solid #eef0f7;">원본</td>
          <td style="padding:12px; font-size:13px; border-bottom:1px solid #eef0f7;">각 1</td>
          <td style="padding:12px; font-size:12px; color:#4b5563; border-bottom:1px solid #eef0f7;">직전 근무지, 당해연도 포함 3년치</td>
        </tr>

        <tr>
          <td style="padding:12px; font-size:13px;">☐ 가족관계증명서 (상세)</td>
          <td style="padding:12px; font-size:13px;">원본</td>
          <td style="padding:12px; font-size:13px;">1</td>
          <td style="padding:12px; font-size:12px; color:#4b5563;">
            부양가족 등록이 필요한 경우<br />
            <span style="color:#5e51ff; font-weight:800;">*주민번호 뒷자리 포함 필수</span>
          </td>
        </tr>
      </table>
    `;

  const deviceBlock = v.isIntern
    ? `
      <div style="margin:0 0 8px 0; padding:10px 12px; border-radius:12px; background-color:#fff1f2; border:1px solid #fecdd3; color:#b91c1c; font-weight:900; font-size:13px; line-height:1.7;">
        인턴십 참여자에게는 랩탑이 지원되지 않습니다. (개인 랩탑 지참 필수)
      </div>
      <div style="font-size:13px; line-height:1.7; color:#111111;">
        - <strong>개인 랩탑 지참</strong>: Windows/Mac 무관<br />
        - <strong>기본 지원 장비</strong>: 모니터 1대, 모니터 연결 허브(MAC)<br />
        <span style="color:#6b7280; font-size:12px;">(*마우스, 키보드 등 개인 장비는 지참 부탁드립니다.)</span>
      </div>
    `
    : `
      <div style="font-size:13px; line-height:1.7; color:#111111;">
        - <strong>기본 지원 장비</strong>: 랩탑 1대, 모니터 1대, 모니터 연결 허브(MAC)<br />
        - <strong>운영체제 선택</strong>: Windows 또는 Mac<br />
        <span style="color:#6b7280; font-size:12px;">(*나머지 악세사리 및 장비(마우스, 키보드 등)는 개인적으로 준비해주시기 바랍니다.)</span>
      </div>
    `;

  // 최종 HTML 반환 (이 HTML이 그대로 복사되어 Gmail 본문에 붙습니다)
  return `
<div style="display:none; max-height:0px; overflow:hidden; opacity:0; color:transparent; mso-hide:all;">
  입사 일정, 제출 서류, 계정/장비 셋업 안내 및 필수 제출 링크 안내드립니다.
</div>

<table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin:0; padding:0; width:100%; background-color:#f6f7fb;">
  <tr>
    <td align="center" style="padding:24px 12px; background-color:#f6f7fb;">

      <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="600" style="width:600px; max-width:600px; background-color:#ffffff; border:1px solid #e7e9f3; border-radius:16px; box-shadow:0 10px 28px rgba(17,17,17,0.08);">
        <tr>
          <td style="padding:28px 24px 18px 24px; font-family:'Noto Sans KR','Apple SD Gothic Neo','Malgun Gothic','Segoe UI',Arial,sans-serif; color:#111111;">

            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="width:100%;">
              <tr>
                <td valign="top" style="padding:0;">
                  <div style="font-size:26px; font-weight:800; line-height:1.25; letter-spacing:-0.02em; margin:0 0 10px 0;">
                    ${titleText}
                  </div>

                  <div style="font-size:14px; line-height:1.6; color:#4b5563;">
                    <span style="display:inline-block; padding:6px 10px; border-radius:999px; background-color:rgba(94,81,255,0.10); color:#3f35ff; font-weight:700;">
                      ${escapeHtml(v.position)}
                    </span>
                    <span style="display:inline-block; margin-left:8px;">
                      ${nameBody(v)}님, 아래 내용을 확인 부탁드립니다.
                    </span>
                  </div>
                </td>

                <td align="right" valign="top" style="width:48px; padding:0;">
                  <div style="width:40px; height:40px; border-radius:14px; background-color:rgba(94,81,255,0.12); text-align:center; line-height:40px; font-size:30px; font-weight:900; color:#5e51ff;">
                    *
                  </div>
                </td>
              </tr>
            </table>

            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin:18px 0 0 0;">
              <tr><td style="border-top:1px solid #e5e7eb; font-size:0; line-height:0;">&nbsp;</td></tr>
            </table>

            <!-- 출근 안내 -->
            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin:18px 0 0 0;">
              <tr>
                <td valign="top" style="width:34px; padding:0 10px 0 0;">
                  <div style="width:28px; height:28px; border-radius:999px; background-color:#5e51ff; color:#ffffff; text-align:center; line-height:28px; font-weight:800;">✓</div>
                </td>
                <td valign="top" style="padding:0;">
                  <div style="font-size:16px; font-weight:800; margin:0 0 8px 0;">출근 안내</div>

                  <div style="font-size:14px; line-height:1.7; color:#111111;">
                    <div style="margin:0 0 6px 0;">✅ <strong>첫 출근일</strong>:   ${ v.confirmDate? escapeHtml(v.confirmDate): `<span style="color:#6b7280;">{날짜를 입력하세요}</span>` } / 첫 출근시간: 10:00</div>
                    <div style="margin:0 0 6px 0;">✅ <strong>주소</strong>: 서울시 강남구 테헤란로 129, 빗썸금융타워 L층</div>
                    <div style="margin:0 0 10px 0;">
                      📞 <strong>로비 도착 후</strong>
                      <span style="color:#5e51ff; font-weight:900; text-decoration:underline;">채용담당자 (010-7376-0490)</span>에게 연락 주시면 안내드리겠습니다.
                    </div>
                    <div style="margin:0 0 6px 0;">출근 복장은 정해진 것 없이 자율복장 입니다.</div>
                    <div style="margin:0;">입사 당일, 개인 이메일로 사내 네트워크/사내 사용 메일 안내를 드릴 예정입니다. :)</div>
                  </div>
                </td>
              </tr>
            </table>

            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin:18px 0 0 0;">
              <tr><td style="border-top:1px solid #e5e7eb; font-size:0; line-height:0;">&nbsp;</td></tr>
            </table>

            <!-- 연봉/기간 -->
            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin:18px 0 0 0;">
              <tr>
                <td valign="top" style="width:34px; padding:0 10px 0 0;">
                  <div style="width:28px; height:28px; border-radius:999px; background-color:#5e51ff; color:#ffffff; text-align:center; line-height:28px; font-weight:800;">₩</div>
                </td>
                <td valign="top" style="padding:0;">
                  <div style="font-size:16px; font-weight:800; margin:0 0 8px 0;">연봉 및 기간 안내</div>

                  <div style="font-size:14px; line-height:1.7; color:#111111;">
                    <div style="margin:0 0 6px 0;">✅ <strong>연봉 최종안</strong>: 승낙한 제안과 동일합니다.</div>
                    ${periodBlock}
                  </div>
                </td>
              </tr>
            </table>

            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin:18px 0 0 0;">
              <tr><td style="border-top:1px solid #e5e7eb; font-size:0; line-height:0;">&nbsp;</td></tr>
            </table>

            <!-- 제출 서류 -->
            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin:18px 0 0 0;">
              <tr>
                <td valign="top" style="width:34px; padding:0 10px 0 0;">
                  <div style="width:28px; height:28px; border-radius:999px; background-color:#5e51ff; color:#ffffff; text-align:center; line-height:28px; font-weight:800;">📄</div>
                </td>
                <td valign="top" style="padding:0;">
                  <div style="font-size:16px; font-weight:800; margin:0 0 6px 0;">필수 제출 서류 안내</div>
                  <div style="font-size:13px; line-height:1.7; color:#4b5563; margin:0 0 12px 0;">
                    입사 전까지 아래 서류를 <strong>PDF 파일</strong>로 제출 바랍니다. <span style="color:#6b7280;">(*하드카피는 불필요합니다.)</span>
                  </div>

                  <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="width:100%; border:1px solid #e7e9f3; border-radius:12px; overflow:hidden;">
                    <tr>
                      <td style="padding:10px 12px; background-color:rgba(94,81,255,0.14); font-weight:800; font-size:13px; color:#111111; border-bottom:1px solid #e7e9f3;">구비 서류</td>
                      <td style="padding:10px 12px; background-color:rgba(94,81,255,0.14); font-weight:800; font-size:13px; color:#111111; border-bottom:1px solid #e7e9f3;">원본/사본</td>
                      <td style="padding:10px 12px; background-color:rgba(94,81,255,0.14); font-weight:800; font-size:13px; color:#111111; border-bottom:1px solid #e7e9f3;">부수</td>
                      <td style="padding:10px 12px; background-color:rgba(94,81,255,0.14); font-weight:800; font-size:13px; color:#111111; border-bottom:1px solid #e7e9f3;">비고</td>
                    </tr>

                    <tr>
                      <td style="padding:12px; font-size:13px; border-bottom:1px solid #eef0f7;">☐ 주민등록등본</td>
                      <td style="padding:12px; font-size:13px; border-bottom:1px solid #eef0f7;">원본</td>
                      <td style="padding:12px; font-size:13px; border-bottom:1px solid #eef0f7;">1</td>
                      <td style="padding:12px; font-size:12px; color:#4b5563; border-bottom:1px solid #eef0f7;">
                        www.gov.kr<br />
                        <span style="color:#5e51ff; font-weight:800;">*주민번호 뒷자리 포함 필수</span>
                      </td>
                    </tr>

                    <tr>
                      <td style="padding:12px; font-size:13px; border-bottom:1px solid #eef0f7;">☐ 신분증</td>
                      <td style="padding:12px; font-size:13px; border-bottom:1px solid #eef0f7;">사본</td>
                      <td style="padding:12px; font-size:13px; border-bottom:1px solid #eef0f7;">1</td>
                      <td style="padding:12px; font-size:12px; color:#4b5563; border-bottom:1px solid #eef0f7;">-</td>
                    </tr>

                    <tr>
                      <td style="padding:12px; font-size:13px;">☐ 통장사본</td>
                      <td style="padding:12px; font-size:13px;">사본</td>
                      <td style="padding:12px; font-size:13px;">1</td>
                      <td style="padding:12px; font-size:12px; color:#4b5563;">-</td>
                    </tr>
                  </table>

                  ${extraDocsBlock}
                </td>
              </tr>
            </table>

            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin:18px 0 0 0;">
              <tr><td style="border-top:1px solid #e5e7eb; font-size:0; line-height:0;">&nbsp;</td></tr>
            </table>

            <!-- 추가 필수 정보 -->
            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin:18px 0 0 0;">
              <tr>
                <td valign="top" style="width:34px; padding:0 10px 0 0;">
                  <div style="width:28px; height:28px; border-radius:999px; background-color:#5e51ff; color:#ffffff; text-align:center; line-height:28px; font-weight:800;">👥</div>
                </td>
                <td valign="top" style="padding:0;">
                  <div style="font-size:16px; font-weight:800; margin:0 0 6px 0;">추가 필수 제출 정보</div>
                  <div style="font-size:13px; line-height:1.7; color:#4b5563; margin:0 0 12px 0;">
                    추가로 입사 전 확인 및 셋업이 필요한 사항이 있어 안내드립니다.
                  </div>

                  <div style="font-size:14px; font-weight:900; color:#5e51ff; margin:0 0 6px 0;">1. 호칭 및 계정 생성</div>
                  <div style="font-size:13px; line-height:1.7; color:#111111;">
                    - 피처링은 수평적인 조직문화를 지향하며 모든 닉네임(영어이름)을 사용하고 있습니다.<br />
                    - 또한 해당 이름은 회사 개인계정으로 함께 사용됩니다. (예: poza@featuring.in)
                  </div>
                  <div style="margin:8px 0 0 0; padding:10px 12px; border-radius:12px; background-color:#fff7ed; border:1px solid #fde68a; font-size:13px; line-height:1.7;">
                    👉 닉네임을 정한 후 <strong>[영문/한글]</strong> 형식으로 회신 부탁드립니다.
                    <div style="margin-top:4px; color:#6b7280; font-size:12px;">
                      예: {닉네임_영문}/{닉네임_한글} &nbsp;|&nbsp; 중복/사용 불가 대비 2~3순위까지 고려 부탁드립니다.
                    </div>
                  </div>

                  <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin:12px 0;">
                    <tr><td style="border-top:1px solid #eef0f7; font-size:0; line-height:0;">&nbsp;</td></tr>
                  </table>

                  <div style="font-size:14px; font-weight:900; color:#5e51ff; margin:0 0 6px 0;">2. 장비 안내 및 사용</div>
                  ${deviceBlock}

                  <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin:12px 0;">
                    <tr><td style="border-top:1px solid #eef0f7; font-size:0; line-height:0;">&nbsp;</td></tr>
                  </table>

                  <div style="font-size:14px; font-weight:900; color:#5e51ff; margin:0 0 6px 0;">3. 피처링 문화 소개서</div>
                  <div style="font-size:13px; line-height:1.7; color:#111111;">
                    서류 제출 및 필수 정보 제출 후, 최하단에 링크된 피처링 문화 소개서를 통해 합류 전에 피처링을 먼저 만나보세요!
                  </div>
                  <div style="margin:10px 0 0 0; font-size:13px; line-height:1.7;">
                    링크: <a href="${cultureUrl}" style="color:#5e51ff; text-decoration:underline; font-weight:800;">${cultureUrl}</a>
                  </div>
                </td>
              </tr>
            </table>

            <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="margin:18px 0 0 0;">
              <tr><td style="border-top:1px solid #e5e7eb; font-size:0; line-height:0;">&nbsp;</td></tr>
            </table>

            <!-- CTA -->
            <div style="margin:18px 0 0 0;">
              <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="width:100%;">
                <tr>
                  <td align="center" style="padding:0;">
                    <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="width:100%;">
                      <tr>
                        <td align="center" bgcolor="#5e51ff" style="border-radius:12px;">
                          <a href="${formUrl}" target="_blank"
                             style="display:block; padding:14px 16px; font-family:'Noto Sans KR','Apple SD Gothic Neo','Malgun Gothic','Segoe UI',Arial,sans-serif; font-size:16px; font-weight:900; color:#ffffff; text-decoration:none;">
                            입사 필수 정보 및 서류 제출하기
                          </a>
                        </td>
                      </tr>
                    </table>
                    <div style="margin:10px 0 0 0; font-size:12px; line-height:1.6; color:#6b7280;">
                      버튼이 열리지 않으면 아래 URL을 복사해 브라우저에 붙여넣어 주세요.<br />
                      <span style="color:#111111;">${formUrl}</span>
                    </div>
                  </td>
                </tr>
              </table>
            </div>

            <div style="margin:18px 0 0 0; font-size:13px; line-height:1.7; color:#111111;">
              궁금하신 점이 있으시면 언제든 편하게 회신 부탁드립니다.<br />
              감사합니다.<br />
              피처링 채용팀 드림
            </div>

          </td>
        </tr>
      </table>

      <div style="height:10px; line-height:10px; font-size:0;">&nbsp;</div>
      <div style="font-family:'Noto Sans KR','Apple SD Gothic Neo','Malgun Gothic','Segoe UI',Arial,sans-serif; font-size:11px; line-height:1.6; color:#9ca3af; text-align:center;">
        © Featuring. This email contains onboarding information.
      </div>

    </td>
  </tr>
</table>
  `;
},
    
    const subjectTemplates = {
      assignment_schedule: (v) => `[Featuring] ${subjectRole(v)} 과제 전형 일정 제안드립니다.`,
      task: (v) => `[Featuring] ${subjectRole(v)} 과제 전형 진행 안내드립니다.`,
      interview1: (v) => `[Featuring] ${subjectRole(v)} 1차 인터뷰 제안드립니다.`,
      interviewFinal: (v) => `[Featuring] ${subjectRole(v)} 1차 인터뷰 결과 안내드립니다.`,
      scheduleConfirm: (v) => `[Featuring] ${subjectRole(v)} 일정 확정 안내드립니다.`,
      reference: (v) => `[Featuring] 레퍼런스 체크 전형 안내드립니다.`,
      finalNotice: (v) => `[Featuring] ${nameFull(v)}님, 최종 인터뷰 결과 안내드립니다.`,
      onboarding: (v) => `[Featuring] ${nameFull(v)}님, ${subjectRole(v)} 입사 안내드립니다.`,
      reject: (v) => `[Featuring] ${nameFull(v)}님, 채용 전형 결과 안내드립니다.`
      },
    };

  // ▼▼▼ [수정] 서식 버튼 이름을 쉽게 가져오기 위한 정보 추가 ▼▼▼
  const templateKeys = { assignment_schedule: '과제 일정', task: '과제전형', interview1: '1차 인터뷰', interviewFinal: '최종 인터뷰', scheduleConfirm: '일정 확정', reference: '레퍼런스 체크', finalNotice: '처우협의', onboarding: '입사 안내', reject: '불합격' };

  /* DOM refs */
  const nameEl = document.getElementById('name');
  const positionEl = document.getElementById('position');
  const previewEl = document.getElementById('preview');
  const copyBtn = document.getElementById('copyBtn');
  const toast = document.getElementById('toast');
  const isInternEl = document.getElementById('isIntern');
  const copySubjectBtn = document.getElementById('copySubjectBtn');
  const subjectPreviewEl = document.getElementById('subjectPreview');
  const historyListEl = document.getElementById('historyList');
    const resetBtn = document.getElementById('resetBtn');

  let currentHtml = '';
  let currentSubject = '';
  let currentKey = ''; // ▼▼▼ [추가] 현재 어떤 버튼을 눌렀는지 기억하는 변수

  function buildVars(){
    const normalizedUrl=(document.getElementById('taskurlSelect')?.value || '').trim();
    const propose=[readDate('p1'),readDate('p2'),readDate('p3')].filter(Boolean);
    const confirm=readDate('c1');
    return { name:(nameEl.value||'').trim()||'지원자', position:(positionEl.value||'').trim()||'포지션', taskurl:normalizedUrl, taskTopic:getTaskTopicByUrl(normalizedUrl), proposeDates:propose, confirmDate:confirm, isIntern:!!(isInternEl && isInternEl.checked) };
  }

  function showPreview(html){ currentHtml=html; previewEl.innerHTML=html; copyBtn.disabled=!html; }
  function showToast(msg, withNote){ const note='날짜나 시간, 금액이나 비어있는 공간을 꼭 확인하여 발송 전 채워주세요.'; toast.innerHTML = withNote ? (escapeHtml(msg) + '<div class="note">' + escapeHtml(note) + '</div>') : escapeHtml(msg); toast.classList.add('show'); clearTimeout(toast._t); toast._t=setTimeout(()=> toast.classList.remove('show'), 3000); }

  // ▼▼▼ [수정] renderTemplateByKey 함수에 현재 누른 버튼 키를 기억하는 기능 추가 ▼▼▼
  function renderTemplateByKey(key){
    currentKey = key; // 사용자가 누른 버튼의 종류(예: 'interview1')를 기억합니다.
    const builder=templates[key];
    if(!builder){ return; }
    try{ const vars=buildVars(); const html=builder(vars, key); showPreview(html); const sb=subjectTemplates[key]; currentSubject = sb ? sb(vars) : '[Featuring] ' + (vars.position||''); subjectPreviewEl.textContent=currentSubject; copySubjectBtn.disabled=!currentSubject; }catch(err){ console.error('[템플릿 렌더 오류]', err); showPreview('<p style="margin:0;color:#b91c1c">서식을 표시하는 중 오류가 발생했습니다.</p>'); currentSubject=''; copySubjectBtn.disabled=true; subjectPreviewEl.textContent=''; }
  }

  function copySubject(){ if(!currentSubject) return; navigator.clipboard.writeText(currentSubject) .then(()=> showToast('제목을 복사했습니다. 발송 전 빈칸을 확인하세요.')) .catch(()=>{ const ta=document.createElement('textarea'); ta.value=currentSubject; document.body.appendChild(ta); ta.select(); try{ document.execCommand('copy'); showToast('제목을 텍스트로 복사했습니다.'); } finally{ document.body.removeChild(ta); } }); }

  // ▼▼▼ [수정] copyHtml 함수에 히스토리를 저장하는 기능 추가 ▼▼▼
  async function copyHtml(){
    if(!currentHtml) return;
    saveHistory(); // ★★★ '서식 복사'를 누르면 히스토리를 저장하는 함수를 실행합니다! ★★★
    const blob=new Blob([currentHtml],{type:'text/html'});
    const item=new ClipboardItem({'text/html':blob});
    try{ await navigator.clipboard.write([item]); showToast('클립보드에 복사했습니다. Gmail 작성창에 붙여넣기(Ctrl/⌘+V) 하세요.', true); }catch(err){ const ta=document.createElement('textarea'); ta.value=currentHtml; document.body.appendChild(ta); ta.select(); try{ document.execCommand('copy'); showToast('HTML 복사 권한이 없어 텍스트로 복사했습니다.'); } catch(e){ alert('복사에 실패했습니다.'); } finally{ document.body.removeChild(ta); } }
  }

    function resetAllFields(){
  // 기본 텍스트 입력
  if (nameEl) nameEl.value = '';
  if (positionEl) positionEl.value = '';

  // 과제 선택
  const taskSelect = document.getElementById('taskurlSelect');
  if (taskSelect) taskSelect.value = '';

  // 날짜/시간 입력들 한번에 초기화
  const ids = [
    'p1y','p1m','p1d','p1w','p1h','p1i',
    'p2y','p2m','p2d','p2w','p2h','p2i',
    'p3y','p3m','p3d','p3w','p3h','p3i',
    'c1y','c1m','c1d','c1w','c1h','c1i'
  ];
  ids.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });

  // 인턴십 체크
  if (isInternEl) isInternEl.checked = false;

  // 미리보기/복사 상태 초기화
  currentHtml = '';
  currentSubject = '';
  currentKey = '';

  previewEl.innerHTML = '아직 선택된 서식이 없습니다.';
  copyBtn.disabled = true;
  copySubjectBtn.disabled = true;
  subjectPreviewEl.textContent = '';

  showToast('입력값을 초기화했습니다.');
}


  /* =================== 히스토리 기능 스크립트 (최종 수정판) =================== */
  const HISTORY_KEY = 'featuringRecruitHistory'; // 브라우저의 '영구 기억 저장소'에 사용할 이름표
  const MAX_HISTORY = 10; // 최대 10개까지 저장

  // '서식 복사' 버튼을 누르면 실행될 함수
  function saveHistory() {
    const vars = buildVars();
    // 지원자 이름이 없으면 저장하지 않음
    if (!vars.name || vars.name === '지원자') return;

    // 1. 현재 시간 기록하기 (타임스탬프)
    const now = new Date();
    const timestamp = `${now.getFullYear()}-${pad2(now.getMonth() + 1)}-${pad2(now.getDate())} ${pad2(now.getHours())}:${pad2(now.getMinutes())}`;

    // 2. 저장할 내용(이름, 포지션, 서식 종류, 시간)을 하나의 묶음으로 만들기
    const historyItem = {
      name: vars.name,
      position: vars.position,
      key: currentKey, // 아까 기억해둔 현재 서식 종류 (예: 'interview1')
      timestamp: timestamp,
    };

    // 3. 기존에 저장된 히스토리 목록을 불러오기
    let history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
    
    // 4. 새로운 내역을 맨 앞에 추가하기 (최신순 정렬)
    history.unshift(historyItem);
    
    // 5. 만약 10개가 넘어가면 가장 오래된 내역 삭제하기
    if (history.length > MAX_HISTORY) {
      history = history.slice(0, MAX_HISTORY);
    }
    
    // 6. 최종 목록을 브라우저의 '영구 기억 저장소'에 다시 저장하기
    localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
    
    // 7. 화면에 히스토리 목록 새로고침하기
    loadHistory();
  }

  // 페이지가 열릴 때, 그리고 히스토리가 추가될 때 실행될 함수
  function loadHistory() {
    if (!historyListEl) return;
    let history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
    if (history.length === 0) {
      historyListEl.innerHTML = '<li class="history-item"><div class="meta">내역이 없습니다.</div></li>';
      return;
    }
    // 저장된 목록을 화면에 예쁘게 표시하기
    historyListEl.innerHTML = history.map(item => `
      <li>
        <a class="history-item" data-name="${escapeHtml(item.name)}" data-position="${escapeHtml(item.position)}">
          <strong>${escapeHtml(item.name)} / ${escapeHtml(item.position)}</strong>
          <div class="meta">
            ${item.timestamp} / <span class="key">[${templateKeys[item.key] || item.key}]</span>
          </div>
        </a>
      </li>
    `).join('');
  }

  // 히스토리 목록의 항목을 클릭했을 때 실행될 함수
  function recallHistoryItem(target) {
    const name = target.dataset.name;
    const position = target.dataset.position;
    if (name) nameEl.value = name;
    if (position) positionEl.value = position;
    showToast(`${name}님의 정보를 불러왔습니다.`);
  }

  /* 바인딩 (이벤트 연결) */
  document.querySelectorAll('.js-template').forEach(btn=>{ btn.addEventListener('click', ()=> renderTemplateByKey(btn.dataset.key)); });
  copyBtn.addEventListener('click', copyHtml);
  copySubjectBtn.addEventListener('click', copySubject);
  if(resetBtn) resetBtn.addEventListener('click', resetAllFields);  
  if(historyListEl) {
    historyListEl.addEventListener('click', (e) => {
      const item = e.target.closest('.history-item');
      if (item) {
        recallHistoryItem(item);
      }
    });
  }

  // 페이지가 처음 열릴 때 히스토리를 한번 불러옵니다.
  loadHistory();
</script>
</body>
</html>
